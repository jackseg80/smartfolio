<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Unified Analytics Dashboard - Real-time ML analysis, risk metrics, performance, market cycles and decision intelligence for your SmartFolio portfolio">
  <title>Unified Analytics - SmartFolio</title>

  <!-- Preconnect to CDNs for better performance -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Critical CSS inline pour √©viter FOUC - Optimisation Nov 2025 -->
  <style>
    /* Critical layout styles - inline pour First Paint rapide */
    body { margin: 0; background: #0e1620; color: #c0caf5; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    .wrap { max-width: 95vw; margin: 0 auto; padding: 1.5rem; }
    .panel-card {
      background: rgba(14, 22, 32, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 1.5rem;
    }
    .metric-value { min-height: 2.5rem; font-size: 2rem; font-weight: 800; }
    /* Skeleton loader pour meilleure perception performance */
    .skeleton {
      background: linear-gradient(90deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.04) 100%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s ease-in-out infinite;
      border-radius: 8px;
      color: transparent !important;
      user-select: none;
    }
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    /* Theme loading inline pour √©viter flash */
    [data-theme="light"] body { background: #f8fafc; color: #1e293b; }
  </style>
  <script>
    // ‚ö° Critical theme loading - DOIT √™tre synchrone pour √©viter FOUC
    (function() {
      const theme = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <!-- Full CSS loaded with preload for better performance -->
  <link rel="preload" href="shared-theme.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="theme-compat.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="css/view-modes.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="components/governance-panel.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="components/decision-index-panel.css?v=20251015fixed" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <!-- IMPORTANT: analytics-unified-theme.css EN DERNIER pour surcharger le DI Panel -->
  <link rel="preload" href="analytics-unified-theme.css?v=20260129v1" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="css/tokens.css">
    <link rel="stylesheet" href="shared-theme.css">
    <link rel="stylesheet" href="theme-compat.css">
    <link rel="stylesheet" href="css/view-modes.css">
    <link rel="stylesheet" href="components/governance-panel.css">
    <link rel="stylesheet" href="components/decision-index-panel.css?v=20251015fixed">
    <link rel="stylesheet" href="analytics-unified-theme.css?v=20260129v1">
  </noscript>

  <!-- Chart.js + plugins - defer pour ne pas bloquer le rendering -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <script defer>
    // ‚úÖ Enregistrement datalabels (idempotent) - s'ex√©cute apr√®s chargement
    window.addEventListener('DOMContentLoaded', () => {
      if (window.Chart && window.ChartDataLabels && !window.__di_dl_registered__) {
        window.Chart.register(window.ChartDataLabels);
        window.Chart.defaults.set('plugins.datalabels', { display: false });
        window.__di_dl_registered__ = true;
        console.debug('‚úÖ chartjs-plugin-datalabels registered (global display: false)');
      }

      if (window.Chart && window.ChartAnnotation && !window.__di_annotation_registered__) {
        window.Chart.register(window.ChartAnnotation);
        window.__di_annotation_registered__ = true;
        console.debug('‚úÖ chartjs-plugin-annotation registered');
      }
    });
  </script>
  <script defer src="debug-logger.js"></script>
  <script defer src="global-config.js"></script>
  <script defer src="appearance.js"></script>
  <script type="module" src="components/nav.js"></script>
  <script type="module" src="components/view-toggle.js"></script>
  <script type="module" src="components/domain-nav.js"></script>
  <script type="module" src="analytics-unified.js"></script>
  <script type="module">
    // ===== AUTH GUARD (Dec 2025) =====
    import { checkAuth } from './core/auth-guard.js';
    await checkAuth();  // V√©rifie authentification + redirect si n√©cessaire
    // =================================

    // ===== VIEW MODE MANAGER (Feb 2026) =====
    import { ViewModeManager } from './core/view-mode-manager.js';
    ViewModeManager.init();
    // ========================================

    import { initDeepLinks } from './components/deep-links.js';
    import {
      selectContradiction01,
      selectEffectiveCap,
      selectGovernanceTimestamp
    } from './selectors/governance.js';

    // Rendre les s√©lecteurs accessibles globalement
    window.selectContradiction01 = selectContradiction01;
    window.selectEffectiveCap = selectEffectiveCap;
    window.selectGovernanceTimestamp = selectGovernanceTimestamp;

    // Anchors for analytics-unified.html - point to actual content
    initDeepLinks({
      'unified-root': 'Unified Analytics',
      'tab-intelligence-ml': 'ML Intelligence',
      'tab-risk': 'Risk Dashboard',
      'tab-performance': 'Performance Monitor',
      'tab-cycles': 'Cycle Analysis',
      'tab-monitoring': 'Advanced Analytics'
    });
  </script>
  <script type="module" src="modules/analytics-unified-main-controller.js"></script>

  <!-- Risk Dashboard Store + Calculation Modules (for flyout panel parity) -->
  <!-- global-config.js already loaded in head, don't reload -->
  <script type="module" src="core/risk-dashboard-store.js"></script>
  <script type="module" src="core/fetcher.js"></script>
  <script type="module" src="modules/signals-engine.js"></script>
  <script type="module" src="modules/cycle-navigator.js"></script>
  <script type="module" src="modules/onchain-indicators.js"></script>
  <script type="module" src="modules/market-regimes.js"></script>
  <script type="module" src="modules/targets-coordinator.js"></script>
  <script type="module" src="core/risk-data-orchestrator.js?v=20251022fix"></script>

  <!-- Auto-load calibrated cycle parameters (synced with cycle-analysis.html) -->
  <script type="module">
    import { autoLoadCalibratedParams, listenForCalibrationUpdates } from './modules/cycle-params-loader.js';

    // Charger les param√®tres calibr√©s au d√©marrage
    document.addEventListener('DOMContentLoaded', async () => {
      await autoLoadCalibratedParams();
      listenForCalibrationUpdates(); // √âcouter les mises √† jour depuis cycle-analysis.html
    });
  </script>

  <!-- AI Chat Styles -->
  <link rel="stylesheet" href="/static/components/ai-chat.css">
</head>

<body>
  <!-- Skip link for keyboard navigation -->
  <a href="#analytics-tabs" class="skip-link">Skip to main content</a>

  <div id="backend-fallback-banner">
    ‚ö† Backend unavailable ‚Äî prudent mode (reduced cap).
  </div>

  <div class="wrap">
    <!-- Page Header (Feb 2026) -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h1 style="margin: 0; font-size: 1.5rem; color: var(--theme-text);">üß† ML Intelligence</h1>
      <view-toggle></view-toggle>
    </div>

    <!-- Navigation contextuelle Analytics Domain (Feb 2026) -->
    <domain-nav domain="analytics"></domain-nav>

    <!-- Governance Panel -->
    <div id="governance-container"></div>

    <div id="unified-root">
      <!-- Skeleton loader visible imm√©diatement pendant le chargement du Decision Index -->
      <!-- min-height increased to 450px to match actual DI panel height and prevent CLS -->
      <div class="di-loading-container panel-card" style="min-height: 450px; position: relative; overflow: hidden;">
        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
          <div class="di-spinner" style="
            width: 40px; height: 40px;
            border: 3px solid var(--theme-border, rgba(255,255,255,0.1));
            border-top-color: var(--brand-primary, #3b82f6);
            border-radius: 50%;
            animation: di-spin 1s linear infinite;
          "></div>
          <div>
            <div style="font-size: 1.1rem; font-weight: 700; color: var(--theme-text, #c0caf5);">
              üéØ Decision Index
            </div>
            <div style="font-size: 0.85rem; color: var(--theme-text-muted, #6b7280);">
              Loading data...
            </div>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
          <div>
            <div class="skeleton" style="height: 80px; margin-bottom: 1rem;"></div>
            <div class="skeleton" style="height: 24px; width: 60%; margin-bottom: 0.75rem;"></div>
            <div class="skeleton" style="height: 16px; width: 80%;"></div>
          </div>
          <div>
            <div class="skeleton" style="height: 60px; margin-bottom: 1rem;"></div>
            <div class="skeleton" style="height: 20px; width: 50%; margin-bottom: 0.75rem;"></div>
            <div class="skeleton" style="height: 40px;"></div>
          </div>
        </div>

        <div style="position: absolute; bottom: 1rem; right: 1rem; font-size: 0.75rem; color: var(--theme-text-muted, #6b7280); display: flex; align-items: center; gap: 0.5rem;">
          <span style="animation: di-pulse 1.2s ease-in-out infinite;">‚è≥</span>
          <span>Fetching ML scores, cycles and on-chain data...</span>
        </div>

        <style>
          @keyframes di-spin { to { transform: rotate(360deg); } }
          @keyframes di-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        </style>
      </div>
    </div>

    <!-- Tabs connect√©s directement aux panels -->
    <div class="tabs-wrapper" style="display: flex; align-items: center; gap: 0.5rem;">
      <div class="tabs" id="analytics-tabs" role="tablist" aria-label="Analytics sections">
        <button class="tab-btn active" data-target="#tab-risk" role="tab" aria-selected="true" aria-controls="tab-risk" id="tab-btn-risk">Risk</button>
        <button class="tab-btn" data-target="#tab-performance" role="tab" aria-selected="false" aria-controls="tab-performance" id="tab-btn-performance">Performance</button>
        <button class="tab-btn pro-only" data-target="#tab-cycles" role="tab" aria-selected="false" aria-controls="tab-cycles" id="tab-btn-cycles">Cycles</button>
        <button class="tab-btn pro-only" data-target="#tab-monitoring" role="tab" aria-selected="false" aria-controls="tab-monitoring" id="tab-btn-monitoring">Monitoring</button>
        <button class="tab-btn pro-only" data-target="#tab-intelligence-ml" role="tab" aria-selected="false" aria-controls="tab-intelligence-ml" id="tab-btn-intelligence-ml">ü§ñ Intelligence ML</button>
      </div>
      <button class="btn-refresh" id="manual-refresh-onchain" title="Force refresh of on-chain indicators" aria-label="Refresh on-chain indicators">üîÑ Refresh</button>
    </div>

    <!-- Tab Panels - min-height prevents CLS during dynamic content load -->
    <section class="tab-panel active" id="tab-risk" role="tabpanel" aria-labelledby="tab-btn-risk" style="min-height: 500px;">
    <div class="panel-card">
      <h2>üõ°Ô∏è Risk Dashboard</h2>
      <div class="metrics-grid-250" aria-live="polite" aria-atomic="false">
        <div class="metric-card" data-metric="risk-var">
          <h3>VaR Portfolio</h3>
          <div class="metric-value skeleton" id="risk-var-value" aria-busy="true">Loading</div>
          <small>95% confidence level</small>
        </div>
        <div class="metric-card" data-metric="risk-drawdown">
          <h3>Maximum Drawdown</h3>
          <div class="metric-value skeleton" id="risk-drawdown-value" aria-busy="true">Loading</div>
          <small>Current cycle</small>
        </div>
        <div class="metric-card" data-metric="risk-volatility">
          <h3>Volatility</h3>
          <div class="metric-value skeleton" id="risk-volatility-value" aria-busy="true">Loading</div>
          <small>Annualized 30 days</small>
        </div>
        <div class="metric-card" data-metric="risk-score">
          <h3>Risk Score</h3>
          <div class="metric-value skeleton" id="risk-score-value" aria-busy="true">Loading</div>
          <small>Unknown</small>
        </div>
      </div>
      <!-- Scores cl√©s du Risk Dashboard (version compl√®te) - Pro only -->
      <div class="metrics-grid-220 pro-only">
        <div class="metric-card" data-metric="risk-kpi-diversification">
          <h3>Diversification Ratio</h3>
          <div class="metric-value">--</div>
          <small>Portfolio correlation</small>
        </div>
        <div class="metric-card" data-metric="risk-kpi-effective-assets">
          <h3>Effective Assets</h3>
          <div class="metric-value">--</div>
          <small>Non-redundant assets</small>
        </div>
        <div class="metric-card" data-metric="risk-kpi-blended">
          <h3>Blended Score</h3>
          <div class="metric-value">--</div>
          <small>Regime score (0-100)</small>
        </div>
        <div class="metric-card" data-metric="risk-kpi-onchain">
          <h3>On-Chain Composite</h3>
          <div class="metric-value" id="risk-kpi-onchain-value">--</div>
          <small>Fondamentaux on-chain</small>
        </div>
      </div>
      <div class="info-section">
        <h3>Alertes Risque</h3>
        <div class="info-section-content" id="risk-alerts-container" aria-live="polite">
          <!-- Alerts populated dynamically by analytics-unified.js -->
          <div class="info-list-item">‚Ä¢ Loading alerts...</div>
        </div>
      </div>
      <div class="actions-row">
        <a href="risk-dashboard.html?nav=off" target="_blank" class="action-link">
          üìä Full Risk Dashboard
        </a>
        <a href="simulations.html?nav=off" target="_blank" class="action-link action-link--success">
          üß™ Full Pipeline Simulator
        </a>
      </div>
      </div>
    </section>
    <section class="tab-panel" id="tab-performance" role="tabpanel" aria-labelledby="tab-btn-performance">
    <div class="panel-card">
      <h2>üìä Performance Monitor</h2>
      <div class="metrics-grid-250" aria-live="polite" aria-atomic="false">
        <div class="metric-card" data-metric="perf-cache-size">
          <h3>Memory Cache Size</h3>
          <div class="metric-value">--</div>
          <small>Cache entries</small>
        </div>
        <div class="metric-card" data-metric="perf-disk-cache">
          <h3>Utilisation Cache Disque</h3>
          <div class="metric-value">-- MB</div>
          <small>Usage disque</small>
        </div>
        <div class="metric-card" data-metric="perf-memory">
          <h3>Process Memory</h3>
          <div class="metric-value">-- MB</div>
          <small>Process memory</small>
        </div>
        <div class="metric-card" data-metric="perf-system-memory">
          <h3>System Memory Usage</h3>
          <div class="metric-value">--%</div>
          <small>System memory</small>
        </div>
      </div>
      <div class="info-section">
        <h3>System Performance</h3>
        <div class="info-section-content">
          <div class="info-item"><span>Cache hit rate:</span><span class="text-positive">--%</span></div>
          <div class="info-item"><span>Available memory:</span><span>-- GB</span></div>
          <div class="info-item"><span>Process efficiency:</span><span>--</span></div>
        </div>
      </div>
      <div class="actions-row">
        <a href="performance-monitor-unified.html" target="_blank" class="action-link">
          üìà Unified Performance Monitor (New)
        </a>
      </div>
      </div>
    </section>
    <section class="tab-panel" id="tab-cycles" role="tabpanel" aria-labelledby="tab-btn-cycles">
    <div class="panel-card">
      <h2>üîÑ Cycle Analysis</h2>
      <div class="metrics-grid-250" aria-live="polite" aria-atomic="false">
        <div class="metric-card" data-metric="cycle-phase">
          <h3>Phase Actuelle</h3>
          <div class="metric-value">--</div>
          <small>Current phase</small>
        </div>
        <div class="metric-card" data-metric="cycle-progress">
          <h3>Post-Halving Progress</h3>
          <div class="metric-value">-- months</div>
          <small>Progress since halving</small>
        </div>
        <div class="metric-card" data-metric="cycle-score">
          <h3>Cycle Score</h3>
          <div class="metric-value">--</div>
          <small>Position in cycle</small>
        </div>
        <div class="metric-card" data-metric="cycle-confidence">
          <h3>Confiance</h3>
          <div class="metric-value">--%</div>
          <small>Model certainty</small>
        </div>
      </div>
      <!-- Timeline visuelle du cycle Bitcoin -->
      <div class="cycle-timeline-container" id="cycle-timeline-container" aria-live="polite">
        <!-- Rendu dynamiquement par analytics-unified.js -->
      </div>

      <div class="info-section">
        <h3>Allocation Multipliers by Phase</h3>
        <div class="info-section-content" id="cycle-multipliers-container">
          <!-- Rendu dynamiquement -->
        </div>
      </div>
      <div class="actions-row">
        <a href="cycle-analysis.html?nav=off" target="_blank" class="action-link">
          üîÑ Full Cycle Analysis
        </a>
      </div>
      </div>
    </section>
    <section class="tab-panel" id="tab-monitoring" role="tabpanel" aria-labelledby="tab-btn-monitoring">
    <div class="panel-card">
      <h2>üìà Advanced Analytics</h2>
      <div class="metrics-grid-250" aria-live="polite" aria-atomic="false">
        <div class="metric-card" data-metric="monitor-total-return">
          <h3>Total Return</h3>
          <div class="metric-value">--%</div>
          <small>Over the period</small>
        </div>
        <div class="metric-card" data-metric="monitor-sharpe">
          <h3>Sharpe Ratio</h3>
          <div class="metric-value">--</div>
          <small>Risk-adjusted</small>
        </div>
        <div class="metric-card" data-metric="monitor-volatility">
          <h3>Volatility</h3>
          <div class="metric-value">--%</div>
          <small>Market risk</small>
        </div>
        <div class="metric-card" data-metric="monitor-drawdown">
          <h3>Drawdown Max</h3>
          <div class="metric-value">--%</div>
          <small>Worst drawdown</small>
        </div>
      </div>
      <div class="info-section">
        <h3>Advanced Metrics</h3>
        <div id="advanced-metrics-breakdown" class="info-section-content"></div>
      </div>
      <div class="actions-row">
        <a href="performance-monitor-unified.html" target="_blank" class="action-link">
          üìä Unified Performance Monitor
        </a>
      </div>
      </div>
    </section>

    <!-- Intelligence ML Tab Panel -->
    <section class="tab-panel" id="tab-intelligence-ml" role="tabpanel" aria-labelledby="tab-btn-intelligence-ml">
    <div class="panel-card">
      <h2>ü§ñ ML Intelligence - Full Analysis View</h2>
      <p>
        Detailed ML model analysis, real-time predictions and advanced administration
      </p>

      <!-- Stats ML Globales -->
      <div class="ml-stats-section">
        <h3>üìä Statistiques ML Globales</h3>
        <div class="metrics-grid-200" aria-live="polite" aria-atomic="false">
          <div class="metric-card">
            <h4>Active Models</h4>
            <div class="metric-value" id="ml-active-models">--/4</div>
            <small>Models loaded</small>
          </div>
          <div class="metric-card">
            <h4>Average Confidence</h4>
            <div class="metric-value" id="ml-avg-confidence">--%</div>
            <small>Confidence level</small>
          </div>
          <div class="metric-card">
            <h4>Last Update</h4>
            <div class="metric-value" id="ml-last-update">--</div>
            <small>Status ML</small>
          </div>
        </div>
      </div>

      <!-- Vue Mod√®les D√©taill√©e -->
      <div class="ml-models-section">
        <h3>üß† Model Health</h3>
        <div class="metrics-grid-250" aria-live="polite" aria-atomic="false">
          <div class="metric-card">
            <h4>üåä Volatility LSTM</h4>
            <div class="metric-value" id="ml-vol-model-status">‚ö™ Unknown</div>
            <small id="ml-vol-model-details">Model status</small>
          </div>
          <div class="metric-card">
            <h4>üîÑ Regime HMM</h4>
            <div class="metric-value" id="ml-regime-model-status">‚ö™ Unknown</div>
            <small id="ml-regime-model-details">Model status</small>
          </div>
          <div class="metric-card">
            <h4>üîó Correlation Transformer</h4>
            <div class="metric-value" id="ml-corr-model-status">‚ö™ Unknown</div>
            <small id="ml-corr-model-details">Model status</small>
          </div>
          <div class="metric-card">
            <h4>üí≠ Sentiment Composite</h4>
            <div class="metric-value" id="ml-sent-model-status">‚ö™ Unknown</div>
            <small id="ml-sent-model-details">Model status</small>
          </div>
        </div>
      </div>

      <!-- Pr√©dictions Temps R√©el -->
      <div class="ml-predictions-section">
        <h3>üîÆ Real-Time Predictions</h3>
        <div id="ml-predictions-container" aria-live="polite">
          <div class="prediction-grid metrics-grid-250" aria-atomic="false">
            <!-- Volatilit√© -->
            <div class="metric-card" data-metric="ml-volatility-btc">
              <h4>BTC 24h Volatility</h4>
              <div class="metric-value" id="ml-vol-btc">--</div>
              <small>LSTM Prediction</small>
            </div>
            <div class="metric-card" data-metric="ml-volatility-eth">
              <h4>ETH 24h Volatility</h4>
              <div class="metric-value" id="ml-vol-eth">--</div>
              <small>LSTM Prediction</small>
            </div>
            <!-- R√©gimes -->
            <div class="metric-card" data-metric="ml-regime">
              <h4>Market Regime</h4>
              <div class="metric-value" id="ml-regime">--</div>
              <small>Classification HMM</small>
            </div>
            <!-- Sentiment -->
            <div class="metric-card" data-metric="ml-sentiment">
              <h4>ML Sentiment</h4>
              <div class="metric-value" id="ml-sentiment">--</div>
              <small>Aggregated ML Sentiment</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Administration ML (repliable, RBAC protected) -->
      <details class="ml-admin-section">
        <summary class="ml-admin-summary">
          üîß Administration ML (Admin Only)
        </summary>
        <div class="ml-admin-content">
          <div id="ml-admin-ops-container"></div>

          <!-- Actions Admin -->
          <div class="admin-actions">
            <button class="btn secondary" id="btn-retrain">
              üîÑ Retrain Models
            </button>
            <button class="btn secondary" id="btn-clear-cache">
              üóëÔ∏è Clear Cache
            </button>
            <button class="btn secondary" id="btn-logs">
              üì• Download Logs
            </button>
            <button class="btn secondary" id="btn-debug">
              üîç Debug Info
            </button>
          </div>

          <!-- ML Pipeline Status -->
          <div class="ml-pipeline-status">
            <h4>Pipeline Status</h4>
            <div id="ml-pipeline-container">
              Loading pipeline status...
            </div>
          </div>
        </div>
      </details>

      <!-- Lien vers Command Center -->
      <div class="actions-row">
        <a href="ai-dashboard.html" target="_blank" class="action-link">
          ü§ñ Open ML Command Center (Ops View)
        </a>
      </div>

      </div>
    </section>

  </div><!-- Fin du wrap principal -->

  <script type="module" src="modules/analytics-unified-tabs-controller.js"></script>

  <!-- Unified Risk Flyout Panel (Full Sidebar) -->
  <script type="module" src="components/flyout-panel.js"></script>
  <script type="module" src="components/risk-sidebar-full.js"></script>
  <script type="module">
    // Adapter le layout quand la sidebar est √©pingl√©e
    import { enableFlyoutLayoutAdapter } from './components/flyout-layout-adapter.js';
    enableFlyoutLayoutAdapter('.wrap'); // D√©caler uniquement le contenu, pas le menu
  </script>

  <flyout-panel position="left" width="340" persist-key="analytics_flyout">
    <span slot="title">üéØ Risk Dashboard</span>
    <risk-sidebar-full slot="content" poll-ms="0"></risk-sidebar-full>
  </flyout-panel>

  <!-- AI Chat Components -->
  <script type="module">
    import { initAIChat } from '/static/components/ai-chat-init.js';

    // Initialize AI Chat for analytics unified page
    initAIChat('analytics-unified');
  </script>

</body>

</html>